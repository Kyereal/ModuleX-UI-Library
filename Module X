-- Module X SetUp Commands
-- SetLoadingText(LoadingText)
-- SetCreditsText(CreditsName)
-- CreateTab(TabName)
-- AddButton(Tab, Button name. callback)
-- AddToggle(tabName, text, defaultState, callback)
-- AddSlider(tabName, text, min, max, defaultValue, callback)
-- SetSliderColor(color)

-- How to use
-- UI:AnyCommand("")

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

if CoreGui:FindFirstChild("ModuleX") then
    CoreGui.ModuleX:Destroy()
end

local ColorNames = {
    Red = Color3.fromRGB(255,0,0),
    Green = Color3.fromRGB(0,255,0),
    Blue = Color3.fromRGB(0,170,255),
    Yellow = Color3.fromRGB(255,255,0),
    Orange = Color3.fromRGB(255,128,0),
    Purple = Color3.fromRGB(128,0,128),
    White = Color3.fromRGB(255,255,255),
    Black = Color3.fromRGB(0,0,0)
}

local UI_CORNER_RADIUS = 10

local ModuleX = {}
ModuleX.__index = ModuleX

function ModuleX.new()
    local self = setmetatable({}, ModuleX)

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ModuleX"
    ScreenGui.Parent = CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui = ScreenGui

    local loadingFrame = Instance.new("Frame")
    loadingFrame.Size = UDim2.new(0,300,0,150)
    loadingFrame.Position = UDim2.new(0.5,0,0.5,0)
    loadingFrame.AnchorPoint = Vector2.new(0.5,0.5)
    loadingFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
    loadingFrame.BorderSizePixel = 0
    loadingFrame.ZIndex = 10
    loadingFrame.Parent = ScreenGui

    local loadingFrameCorner = Instance.new("UICorner")
    loadingFrameCorner.CornerRadius = UDim.new(0, UI_CORNER_RADIUS)
    loadingFrameCorner.Parent = loadingFrame

    local loadingText = Instance.new("TextLabel")
    loadingText.Text = ""
    loadingText.Font = Enum.Font.GothamBold
    loadingText.TextSize = 30
    loadingText.TextColor3 = Color3.fromRGB(255,255,255)
    loadingText.BackgroundTransparency = 1
    loadingText.AnchorPoint = Vector2.new(0.5,0)
    loadingText.Position = UDim2.new(0.5,0,0.1,0)
    loadingText.Size = UDim2.new(0,250,0,40)
    loadingText.ZIndex = 11
    loadingText.Parent = loadingFrame
    self.LoadingText = loadingText

    local creditsText = Instance.new("TextLabel")
    creditsText.Text = "Script by kye._real."
    creditsText.Font = Enum.Font.Gotham
    creditsText.TextSize = 20
    creditsText.TextColor3 = Color3.fromRGB(200,200,200)
    creditsText.BackgroundTransparency = 1
    creditsText.AnchorPoint = Vector2.new(0.5,0)
    creditsText.Position = UDim2.new(0.5,0,0.3,0)
    creditsText.Size = UDim2.new(0,250,0,30)
    creditsText.ZIndex = 11
    creditsText.Parent = loadingFrame
    self.CreditText = creditsText

    local loadingBarFrame = Instance.new("Frame")
    loadingBarFrame.Size = UDim2.new(0,250,0,10)
    loadingBarFrame.Position = UDim2.new(0.5,0,0.7,0)
    loadingBarFrame.AnchorPoint = Vector2.new(0.5,0)
    loadingBarFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    loadingBarFrame.Parent = loadingFrame

    local loadingBarFrameCorner = Instance.new("UICorner")
    loadingBarFrameCorner.CornerRadius = UDim.new(0, UI_CORNER_RADIUS)
    loadingBarFrameCorner.Parent = loadingBarFrame

    local loadingBar = Instance.new("Frame")
    loadingBar.Size = UDim2.new(0,0,1,0)
    loadingBar.Position = UDim2.new(0,0,0,0)
    loadingBar.BackgroundColor3 = Color3.fromRGB(0,255,0)
    loadingBar.Parent = loadingBarFrame

    local window = Instance.new("Frame")
    window.Size = UDim2.new(0,600,0,400)
    window.Position = UDim2.new(0.5,0,0.5,0)
    window.AnchorPoint = Vector2.new(0.5,0.5)
    window.BackgroundColor3 = Color3.fromRGB(25,25,25)
    window.BorderSizePixel = 0
    window.Visible = false
    window.Parent = ScreenGui
    self.Window = window

    local windowCorner = Instance.new("UICorner")
    windowCorner.CornerRadius = UDim.new(0, UI_CORNER_RADIUS)
    windowCorner.Parent = window

    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1,0,0,30)
    titleBar.BackgroundColor3 = Color3.fromRGB(35,35,35)
    titleBar.Parent = window
    self.TitleBar = titleBar

    local titleBarCorner = Instance.new("UICorner")
    titleBarCorner.CornerRadius = UDim.new(0, UI_CORNER_RADIUS)
    titleBarCorner.Parent = titleBar

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1,-60,1,0)
    titleLabel.Position = UDim2.new(0,10,0,0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "ModuleX"
    titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 14
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar

    local isOpen = true
    local function createIconButton(name,text,pos,callback)
        local btn = Instance.new("TextButton")
        btn.Name = name
        btn.Size = UDim2.new(0,30,0,30)
        btn.Position = pos
        btn.BackgroundTransparency = 1
        btn.Text = text
        btn.TextColor3 = Color3.fromRGB(255,255,255)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 14
        btn.Parent = titleBar
        btn.MouseButton1Click:Connect(callback)
        return btn
    end

    createIconButton("Close","X",UDim2.new(1,-30,0,0),function() ScreenGui:Destroy() end)
    createIconButton("Minimize","_",UDim2.new(1,-60,0,0),function()
        if isOpen then
            window.Visible = false
            isOpen = false
        end
    end)

    local sidebar = Instance.new("ScrollingFrame")
    sidebar.Size = UDim2.new(0,140,1,-30)
    sidebar.Position = UDim2.new(0,0,0,30)
    sidebar.BackgroundColor3 = Color3.fromRGB(30,30,30)
    sidebar.ScrollBarThickness = 6
    sidebar.CanvasSize = UDim2.new(0,0,0,0)
    sidebar.Parent = window
    self.Sidebar = sidebar

    local sidebarLayout = Instance.new("UIListLayout")
    sidebarLayout.Padding = UDim.new(0,5)
    sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
    sidebarLayout.Parent = sidebar

    local sidebarPadding = Instance.new("UIPadding")
    sidebarPadding.PaddingTop = UDim.new(0,10)
    sidebarPadding.PaddingBottom = UDim.new(0,10)
    sidebarPadding.PaddingLeft = UDim.new(0,5)
    sidebarPadding.PaddingRight = UDim.new(0,5)
    sidebarPadding.Parent = sidebar

    local avatarImage = Instance.new("ImageLabel")
    avatarImage.Size = UDim2.new(0,60,0,60)
    avatarImage.Position = UDim2.new(0.5,0,0,10)
    avatarImage.AnchorPoint = Vector2.new(0.5,0)
    avatarImage.BackgroundTransparency = 1
    avatarImage.Image = "rbxthumb://type=AvatarHeadShot&id="..Players.LocalPlayer.UserId.."&w=150&h=150"
    avatarImage.Parent = sidebar

    local usernameLabel = Instance.new("TextLabel")
    usernameLabel.Size = UDim2.new(1,0,0,20)
    usernameLabel.Position = UDim2.new(0,0,0,75)
    usernameLabel.BackgroundTransparency = 1
    usernameLabel.Text = Players.LocalPlayer.Name
    usernameLabel.TextColor3 = Color3.fromRGB(255,255,255)
    usernameLabel.Font = Enum.Font.Gotham
    usernameLabel.TextSize = 14
    usernameLabel.TextXAlignment = Enum.TextXAlignment.Center
    usernameLabel.Parent = sidebar

    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, -140, 1, -30)
    contentFrame.Position = UDim2.new(0, 140, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 6
    contentFrame.CanvasSize = UDim2.new(0,0,0,0)
    contentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    contentFrame.Parent = window
    self.ContentFrame = contentFrame

    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0,10)
    listLayout.Parent = contentFrame

    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0,10)
    padding.PaddingBottom = UDim.new(0,10)
    padding.PaddingLeft = UDim.new(0,10)
    padding.PaddingRight = UDim.new(0,10)
    padding.Parent = contentFrame

    local dragging, dragInput, dragStart, startPos
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = window.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            window.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,
                                        startPos.Y.Scale,startPos.Y.Offset+delta.Y)
        end
    end)

    self.Tabs = {}
    self.Pages = {}
    self.SliderFills = {}

    local creditsPage = self:CreateTab("Credits")
    local creditLabel = Instance.new("TextLabel")
    creditLabel.Size = UDim2.new(1,-20,1,-20)
    creditLabel.Position = UDim2.new(0,10,0,10)
    creditLabel.Text = "Made by kye._real.\nEnjoy using ModuleX!\nScript Inspired by Rayfield"
    creditLabel.TextWrapped = true
    creditLabel.TextColor3 = Color3.fromRGB(255,255,255)
    creditLabel.Font = Enum.Font.Gotham
    creditLabel.TextSize = 18
    creditLabel.BackgroundTransparency = 1
    creditLabel.Parent = creditsPage

    task.spawn(function()
        task.wait(2)
        local barTweenInfo = TweenInfo.new(1, Enum.EasingStyle.Linear)
        local barTween = TweenService:Create(loadingBar, barTweenInfo, {Size = UDim2.new(1,0,1,0)})
        barTween:Play()
        barTween.Completed:Wait()
        task.wait(0.2)
        local fadeTweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        TweenService:Create(loadingFrame, fadeTweenInfo, {BackgroundTransparency = 1}):Play()
        TweenService:Create(loadingText, fadeTweenInfo, {TextTransparency = 1}):Play()
        TweenService:Create(creditsText, fadeTweenInfo, {TextTransparency = 1}):Play()
        loadingFrame:Destroy()
        window.Visible = true
        window.Size = UDim2.new(0,0,0,0)
        TweenService:Create(window, TweenInfo.new(0.45, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0,600,0,400)}):Play()
        for _, page in pairs(self.Pages) do page.Visible = false end
        local defaultTab = self.Pages["Credits"] or next(self.Pages)
        if defaultTab then defaultTab.Visible = true end
    end)

    return self
end

function ModuleX:SetLoadingText(text)
    if self.LoadingText then
        self.LoadingText.Text = text
    end
end

function ModuleX:SetCreditsText(text)
    if self.CreditText then
        self.CreditText.Text = text
    end
end

function ModuleX:CreateTab(name)
    if self.Pages[name] then return self.Pages[name] end

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-10,0,35)
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.AutoButtonColor = false
    btn.Parent = self.Sidebar
    btn.ClipsDescendants = true

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, UI_CORNER_RADIUS)
    corner.Parent = btn

    btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(75,75,75) end)
    btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(60,60,60) end)

    local layout = self.Sidebar:FindFirstChildOfClass("UIListLayout")
    if layout then
        self.Sidebar.CanvasSize = UDim2.new(0,0,0, layout.AbsoluteContentSize.Y + 10)
        layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            self.Sidebar.CanvasSize = UDim2.new(0,0,0, layout.AbsoluteContentSize.Y + 10)
        end)
    end

    local page = Instance.new("ScrollingFrame")
    page.Size = UDim2.new(1,0,1,0)
    page.Visible = false
    page.BackgroundTransparency = 1
    page.ScrollBarThickness = 6
    page.CanvasSize = UDim2.new(0,0,0,0)
    page.AutomaticCanvasSize = Enum.AutomaticSize.None
    page.Name = name
    page.Parent = self.ContentFrame
    self.Pages[name] = page

    local pageLayout = Instance.new("UIListLayout")
    pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    pageLayout.Padding = UDim.new(0,10)
    pageLayout.Parent = page

    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0,10)
    padding.PaddingBottom = UDim.new(0,10)
    padding.PaddingLeft = UDim.new(0,10)
    padding.PaddingRight = UDim.new(0,10)
    padding.Parent = page

    pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        page.CanvasSize = UDim2.new(0,0,0, pageLayout.AbsoluteContentSize.Y + 25)
    end)

    btn.MouseButton1Click:Connect(function()
        for _, p in pairs(self.Pages) do p.Visible = false end
        page.Visible = true
    end)

    return page
end

function ModuleX:AddButton(tabName, text, callback)
    local tab = self.Pages[tabName]
    if not tab then return warn("Tab does not exist: "..tabName) end

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,0,0,40)
    btn.BackgroundColor3 = Color3.fromRGB(30,30,30)
    btn.Text = text
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.AutoButtonColor = false
    btn.Parent = tab
    btn.ClipsDescendants = true

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    corner.Parent = btn

    btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(40,40,40) end)
    btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(30,30,30) end)
    btn.MouseButton1Click:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(20,20,20)
        task.wait(0.05)
        btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
        if callback then callback() end
    end)
end

function ModuleX:AddToggle(tabName, text, defaultState, callback)
    local tab = self.Pages[tabName]
    if not tab then return warn("Tab does not exist: "..tabName) end

    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1,0,0,40)
    toggleFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    toggleFrame.ClipsDescendants = true
    toggleFrame.Parent = tab

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    corner.Parent = toggleFrame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,-50,1,0)
    label.Position = UDim2.new(0,10,0,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Text = text
    label.Parent = toggleFrame

    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0,40,0,20)
    toggleButton.Position = UDim2.new(1,-50,0.5,-10)
    toggleButton.BackgroundColor3 = defaultState and (self.SliderColor or Color3.fromRGB(0,170,255)) or Color3.fromRGB(60,60,60)
    toggleButton.Text = ""
    toggleButton.Parent = toggleFrame

    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    toggleCorner.Parent = toggleButton

    local state = defaultState or false

    local function updateToggle()
        toggleButton.BackgroundColor3 = state and (self.SliderColor or Color3.fromRGB(0,170,255)) or Color3.fromRGB(60,60,60)
    end
    updateToggle()

    toggleButton.MouseButton1Click:Connect(function()
        state = not state
        updateToggle()
        if callback then callback(state) end
    end)
end

function ModuleX:AddSlider(tabName, text, min, max, default, callback)
    local tab = self.Pages[tabName]
    if not tab then return warn("Tab does not exist: "..tabName) end

    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1,0,0,40)
    sliderFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    sliderFrame.ClipsDescendants = true
    sliderFrame.Parent = tab

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    corner.Parent = sliderFrame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,-20,0,20)
    label.Position = UDim2.new(0,10,0,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Text = text
    label.Parent = sliderFrame

    local sliderBar = Instance.new("Frame")
    sliderBar.Size = UDim2.new(1,-20,0,8)
    sliderBar.Position = UDim2.new(0,10,0,25)
    sliderBar.BackgroundColor3 = Color3.fromRGB(60,60,60)
    sliderBar.Parent = sliderFrame

    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    sliderCorner.Parent = sliderBar

    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    sliderFill.BackgroundColor3 = self.SliderColor or Color3.fromRGB(0,170,255)
    sliderFill.Parent = sliderBar

    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0,UI_CORNER_RADIUS)
    fillCorner.Parent = sliderFill

    table.insert(self.SliderFills, sliderFill)

    local dragging = false

    sliderBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)

    sliderBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mouseX = input.Position.X - sliderBar.AbsolutePosition.X
            local perc = math.clamp(mouseX / sliderBar.AbsoluteSize.X, 0, 1)
            sliderFill.Size = UDim2.new(perc,0,1,0)
            local value = min + perc*(max-min)
            if callback then callback(value) end
        end
    end)
end

function ModuleX:SetSliderColor(color)
    if type(color) == "string" then
        local c = ColorNames[color]
        if not c then
            warn("Color not found: " .. tostring(color))
            return
        end
        self.SliderColor = c
    elseif typeof(color) == "Color3" then
        self.SliderColor = color
    else
        warn("Invalid color. Use a predefined name or Color3.")
        return
    end

    if self.SliderFills then
        for _, fill in pairs(self.SliderFills) do
            fill.BackgroundColor3 = self.SliderColor
            fill.Parent.BackgroundColor3 = self.SliderColor
        end
    end
end

return ModuleX
